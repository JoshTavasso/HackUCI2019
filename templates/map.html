<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <title>Is your car safe?</title>
	<style>
			#map{
				height:100%;
				width: 100%;
			}
			body, html{
				height: 100%;
				width: 100%
			}
            #input {
                margin: 10px 10px 0px 0px;
                width: 400px;
            }
	</style>
</head>
<body>
    <!-- maps and places scripts -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDYup8ip5-C6qCf1J6KIrP2hJg4yhB88Xk&callback=initMap&libraries=places" type="text/javascript"></script>
    <input id="input" type="text"></input>
	<div id="map"></div>
    <!-- TODO add Bootstrap to make input nicer -->
	<script>
        function coords(newLat, newLng)
        {
            this.lat = newLat,
            this.lng = newLng
        };
        function props(newLat,newLng,newContent)
        {
            this.coords = {lat: newLat, lng: newLng},
            this.information = newContent;
        };

        var field;
        //Place object with lat and long
        var result;
		function initMap(){
			var options = {
				zoom: 8,
				center: {lat:37.7749, lng: -122.4194}
            };
            //creating a new map

    		var map = new google.maps.Map(document.getElementById('map'), options);

    		//Array
    		/*
    		var markers = [
    			{coords:{lat:37.8199, lng: -122.4783},
    			content: '<h1> Golden Gate Bridge </h1>'
    			//adding a new data memeber to the object
    			//,iconImage:
    			},
    			{coords:{lat:37.7793, lng: -122.4193}}
    		];
			*/
    		var test1 = new props(37.7793,-122.4193, '<h1> Golden Gate Bridge </h1>');
    		//test1.setCoords(37.87199,-122.4783);
    		//test1.setContent('<h1> Golden Gate Bridge');

    		var test2 = new props(37.7793,-122.4193, '<h2> hi </h2>');
    		//test1.setCoords(37.7793,-122.4193);

    		var markers = [
    			test1, test2,{coords:{lat:37.7793, lng: -122.4193}}
    		];

    		//looping through markers
    		for(var i = 0; i < markers.length; ++i)
    		{
    			addMarker(markers[i]);
    			//console.log(markers[i].coords);
    			//console.log(markers[i].information);
    		}
    		//add marker function takes in lat and long
    		//{lat: int, lng: ing}
    		function addMarker(props)
    		{
                //delete any existing markers
                //zoom in on marker
    			console.log(props.coords);
    			var markers = new google.maps.Marker({
    			position: props.coords,
    			map: map
    			//used to set a custom icon
    			//icon:
    			});

    			//check content
    			if(props.content)
    			{
    				var infoWindow = new google.maps.InfoWindow({
	    			content: props.content
	    			});

	    			markers.addListener('click', function(){
	    			infoWindow.open(map, markers)});
    			}

    		}
            // set SF boundaries;

            //set up text field
            var SFboundaries;
            var input = document.getElementById('input');

            field = new google.maps.places.Autocomplete(input);
            field.bindTo('bounds', map);
            field.setFields(['geometry', 'name']);
            map.controls[google.maps.ControlPosition.TOP_CENTER].push(input);

            field.addListener("place_changed", function() {
                result = field.getPlace();
                if (!result.geometry) {
                    window.alert("No details available for input: '" + place.name + "'");
                    return;
                } else {
                    var p = new props(result.geometry.location.lat(), result.geometry.location.lng(), result.name);
                    console.log(result);
                    addMarker(p);
                }
                //TODO add marker

                //TODO search for vehicle incidents - backend
                //result.geometry.location.toJSON();
                //TODO back end code
                //TODO clear old markers
                //TODO make new markers
            });
        }

    </script>


</body>

</html>
