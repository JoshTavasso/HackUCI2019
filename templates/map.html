<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <title>Is your car safe?</title>
	<style>
			#map{
				height:100%;
				width: 100%;
			}
			body, html{
				height: 100%;
				width: 100%
			}
            #input {
                margin: 10px 10px 0px 0px;
                width: 400px;
            }
	</style>
</head>
<body>
    <!-- maps and places scripts -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDYup8ip5-C6qCf1J6KIrP2hJg4yhB88Xk&callback=initMap&libraries=places" type="text/javascript"></script>
    <input id="input" type="text"></input>
	<div id="map"></div>
    <!-- TODO add Bootstrap to make input nicer -->
	<script>
        function props(newLat,newLng,newContent)
        {
            this.coords = {lat: newLat, lng: newLng},
            this.information = newContent;
        };
        //Place object with lat and long
        var result;
		function initMap(){

			var options = {
				zoom: 13,
				center: {lat:37.7749, lng: -122.4194}
            };
            //creating a new map
            //set up strict bounds for map to SF
    		var map = new google.maps.Map(document.getElementById('map'), options);

    		//Array
    		var markers = [];
            //takes in props object
    		function addMarker(props)
    		{
                //delete any existing markers
                //zoom in on marker
    			console.log(props.coords);
    			var markers = new google.maps.Marker({
    			position: props.coords,
    			map: map
    			//used to set a custom icon
    			//icon:
    			});

    			//check content
    			if(props.content)
    			{
    				var infoWindow = new google.maps.InfoWindow({
	    			content: props.content
	    			});

	    			markers.addListener('click', function(){
	    			infoWindow.open(map, markers)});
    			}

    		}
            // set SF boundaries;

            //set up text field
            var SFboundaries;
            var input = document.getElementById('input');

            var field = new google.maps.places.Autocomplete(input);
            field.bindTo('bounds', map);
            field.setFields(['geometry', 'name']);
            map.controls[google.maps.ControlPosition.TOP_CENTER].push(input);

            field.addListener("place_changed", function() {
                result = field.getPlace();
                if (!result.geometry) {
                    window.alert("No details available for input: '" + place.name + "'");
                    return;
                } else {
                    var p = new props(result.geometry.location.lat(), result.geometry.location.lng(), result.name);
                    console.log(result);
                    addMarker(p);
                }

                //TODO add marker
                //TODO search for vehicle incidents - backend
                //result.geometry.location.toJSON();
                //TODO back end code
                //TODO clear old markers
                //TODO make new markers
            });
        }

    </script>


</body>

</html>
